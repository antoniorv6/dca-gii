---
import Layout from '../../layouts/Layout.astro';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
    const practices = (await getCollection('sobreExamen')).sort((a, b) => {
    const orderA = a.data.order ?? Number.MAX_SAFE_INTEGER;
    const orderB = b.data.order ?? Number.MAX_SAFE_INTEGER;

    if (orderA !== orderB) return orderA - orderB;

    // En caso de empate (mismo order), ordena por título
    return a.data.title.localeCompare(b.data.title);
    });

    console.log(practices.map(p => p.slug)); // Muestra los slugs en la consola
    
    // Render each practice to get its headings
    const paths = await Promise.all(
        practices.map(async (practice) => {
            const { headings } = await practice.render();
            return {
                params: { id: practice.slug },
                props: { 
                    practice,
                    headings 
                }
            };
        })
    );
    
    return paths;
}

const practices = (await getCollection('sobreExamen')).sort((a, b) => {
  const orderA = a.data.order ?? Number.MAX_SAFE_INTEGER;
  const orderB = b.data.order ?? Number.MAX_SAFE_INTEGER;

  if (orderA !== orderB) return orderA - orderB;

  // En caso de empate (mismo order), ordena por título
  return a.data.title.localeCompare(b.data.title);
});

const { practice, headings } = Astro.props;
const { Content } = await practice.render();

const sidebar = practices.map(practice => ({
    label: practice.data.title,  // Uses the title from frontmatter
    link: `/sobreExamen/${practice.slug}` // Creates the link using the file slug
}));
---

<Layout>
    <StarlightPage 
        frontmatter={{
            title: practice.data.title,
        }} 
        headings={headings}
        sidebar={sidebar}
    >
        <Content />
    </StarlightPage>
</Layout>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Compilación de grandes proyectos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="08-repaso_files/libs/clipboard/clipboard.min.js"></script>
<script src="08-repaso_files/libs/quarto-html/quarto.js"></script>
<script src="08-repaso_files/libs/quarto-html/popper.min.js"></script>
<script src="08-repaso_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="08-repaso_files/libs/quarto-html/anchor.min.js"></script>
<link href="08-repaso_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="08-repaso_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="08-repaso_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="08-repaso_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="08-repaso_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>
    .columns .column:has(+ .column) { padding-right: 0.5em; }
</style>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Compilación de grandes proyectos</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="ejercicio.-coordinación-de-agentes" class="level2">
<h2 class="anchored" data-anchor-id="ejercicio.-coordinación-de-agentes">Ejercicio. Coordinación de agentes</h2>
<p>Implementa el siguiente diagrama de clases en Python.</p>
<p>La clase Coordinador almacena una lista de agentes que pueden ser de dos tipos: Asistencia y Comercial (asume que la lista está inicializada con agentes). El coordinador buscará el primer agente disponible que coincida con el tipo de tarea, usando el atributo tipo de las dos clases para realizar la comprobación.</p>
<ul>
<li>Los agentes asistenciales pueden estar libres u ocupados. Sólo se asignarán tareas a agentes libres.</li>
<li>Si la tarea es de tipo comercial, se asignará al primer agente comercial que se encuentre en la lista.</li>
<li>Para todos los agentes, el método ejecutar_tarea mostrará un mensaje de log indicando que se está procesando una tarea, junto con su descripción.</li>
<li>Al terminar la ejecución de las tareas, se cambiará el estado de la tarea a COMPLETADA.</li>
<li>Los agentes asistenciales además cambiarán su estado a ocupado al comienzo de la función ejecutar_tarea, y de nuevo a LIBRE al final de la función.</li>
</ul>
<p>Los valores indicados entre [ ] son los valores posibles que pueden tomar las variables correspondientes.</p>
<p><img src="../images/diagrams/t08-repaso/agentes.svg" class="img-fluid"></p>
</section>
<section id="ejercicio.-reparto-de-pedidos" class="level2">
<h2 class="anchored" data-anchor-id="ejercicio.-reparto-de-pedidos">Ejercicio. Reparto de pedidos</h2>
<p>Implementa el siguiente diagrama de clases en Python.</p>
<p>Especificaciones:</p>
<ul>
<li>Todos los atributos públicos marcados como <code>{readonly}</code> son propiedades de sólo lectura, y deben tener un atributo privado asociado.</li>
<li>La clase <code>Paquete</code> se inicializa con una zona y un peso.</li>
<li>La clase <code>PaqueteCombinado</code> se inicializa con una lista de paquetes que almacenará internamente.</li>
<li>El atributo <code>PaqueteCombinado::peso</code> será una propiedad de sólo lectura que devolverá la suma de los pesos de todos los paquetes que contiene.</li>
<li>La clase Repartidor se inicializa con una zona y un peso máximo que puede llevar. El atributo <code>carga</code> se inicializa a 0.</li>
<li>El método <code>Repartidor::asignar_paquete</code> asigna un paquete al repartidor, siempre que este tenga capacidad para llevarlo (es decir, que no supere su peso máximo). Si tiene capacidad, se añade el paquete a su lista de paquetes y se incrementa su carga actual. Si no tiene capacidad, lanzará una excepción <code>ValueError</code>.</li>
<li>La clase Equipo se inicializa con una lista de Repartidores.</li>
<li>El método <code>Equipo::asignar_paquete</code> asigna el paquete al primer repartidor que encuentre en la lista que tenga capacidad para para llevarlo.</li>
</ul>
<p><img src="../images/diagrams/t08-repaso/repartidores.svg" class="img-fluid"></p>
<div class="menu section-ordered-list">
<ol type="1">
<li><a href="#Introducción">Introducción</a></li>
<li><a href="#Make">Make</a></li>
<li><a href="#Ccache">Ccache</a></li>
<li><a href="#Ninja">Ninja</a></li>
<li><a href="#CI">CI</a></li>
</ol>
</div>
</section>
<section id="Introducción" class="level1" data-stack-name="Introducción">
<h1 data-stack-name="Introducción">Introducción</h1>
<section id="cómo-compilamos-software" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="cómo-compilamos-software">Cómo compilamos <em>software</em></h2>
<p>Hasta ahora, hemos compilado nuestros proyectos en C y C++ a través de comandos.</p>
</section>
<section id="cómo-compilamos-software-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="cómo-compilamos-software-1">Cómo compilamos <em>software</em></h2>
<p>Hasta ahora, hemos compilado nuestros proyectos en C y C++ a través de comandos.</p>
<p>Primero generamos los objetos individualizados de nuestros ficheros (<strong>compilación</strong>).</p>
<pre class="shell"><code>g++ -c src/&lt;ficheros&gt;.cpp -I ...</code></pre>
</section>
<section id="cómo-compilamos-software-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="cómo-compilamos-software-2">Cómo compilamos <em>software</em></h2>
<p>Hasta ahora, hemos compilado nuestros proyectos en C y C++ a través de comandos.</p>
<p>Después enlazamos las llamadas entre objetos y librerías para generar un único ejecutable (<strong>enlazado</strong>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">g++</span> <span class="at">-o</span> game src/<span class="op">&lt;</span>ficheros<span class="op">&gt;</span>.o <span class="at">-L</span> ... <span class="at">-llibreria</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="cómo-compilamos-software-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="cómo-compilamos-software-3">Cómo compilamos <em>software</em></h2>
<p>Compilar a mano en un proyecto pequeño en <code>C++</code> es asumible, aunque pesado.</p>
</section>
<section id="cómo-compilamos-software-4" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="cómo-compilamos-software-4">Cómo compilamos <em>software</em></h2>
<p>Compilar a mano en un proyecto pequeño en <code>C++</code> es asumible, aunque pesado.</p>
<p>Sin embargo… ¿qué pasa cuando tenemos doscientos ficheros?</p>
</section>
<section id="una-vía-de-escape" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="una-vía-de-escape">Una vía de escape…</h2>
<p>Para solucionarlo, podemos generar un único <em>shell script</em> que ejecutaremos cada vez que realicemos cambios en el proyecto.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">g++</span> <span class="at">-o</span> game src/<span class="pp">*</span>.cpp <span class="at">-I</span> src/ <span class="at">-I</span> <span class="op">&lt;</span>librerias<span class="op">&gt;</span> -L <span class="op">&lt;</span>librerias<span class="op">&gt;</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="un-problema-de-escalado" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="un-problema-de-escalado">Un problema de escalado</h2>
<p>Esta solución <strong>recompila todo el proyecto</strong> independientemente de los cambios que hayamos realizado.</p>
</section>
<section id="un-problema-de-escalado-1" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="un-problema-de-escalado-1">Un problema de escalado</h2>
<p>Esta solución <strong>recompila todo el proyecto</strong> independientemente de los cambios que hayamos realizado.</p>
<p>En proyectos pequeños, no notamos este detalle…</p>
</section>
<section id="un-problema-de-escalado-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="un-problema-de-escalado-2">Un problema de escalado</h2>
<p>Esta solución <strong>recompila todo el proyecto</strong> independientemente de los cambios que hayamos realizado.</p>
<p>En proyectos pequeños, no notamos este detalle…</p>
<p>¿Pero y en los grandes?</p>
</section>
<section id="un-problema-de-escalado-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="un-problema-de-escalado-3">Un problema de escalado</h2>
<p>Esta solución <strong>recompila todo el proyecto</strong> independientemente de los cambios que hayamos realizado.</p>
<p>En proyectos pequeños, no notamos este detalle…</p>
<p>¿Pero y en los grandes?</p>
<div class="badge">
<p>En los proyectos grandes, esta política genera <strong>cuello de botella notable</strong>.</p>
</div>
</section>
<section id="un-problema-de-escalado-4" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="un-problema-de-escalado-4">Un problema de escalado</h2>
<p>Este motivo es lo que justifica la aparición de los <strong>entornos de desarrollo</strong></p>
<div class="fragment">
<ul>
<li>Ecosistemas de compilación (Make, Ninja, CMake, etc)</li>
<li>IDEs (Visual Studio, CLion)</li>
</ul>
</div>
</section>
<section id="capas-y-ecosistema-de-compilación" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="capas-y-ecosistema-de-compilación">Capas y ecosistema de compilación</h2>
<p>Existe una <strong>jerarquía</strong> de capas para la compilación y la producción de proyectos <em>software</em>.</p>
</section>
<section id="capas-y-ecosistema-de-compilación-1" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="capas-y-ecosistema-de-compilación-1">Capas y ecosistema de compilación</h2>
<p>Existe una <strong>jerarquía</strong> de capas para la compilación y la producción de proyectos <em>software</em>.</p>
<p><strong>Capa 0: Compiladores</strong></p>
<ul>
<li>Traducen el código fuente a objetos y ejecutables.</li>
<li><code>g++</code>, <code>clang</code>, <code>msvc</code>.</li>
</ul>
</section>
<section id="capas-y-ecosistema-de-compilación-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="capas-y-ecosistema-de-compilación-2">Capas y ecosistema de compilación</h2>
<p>Existe una <strong>jerarquía</strong> de capas para la compilación y la producción de proyectos <em>software</em>.</p>
<p><strong>Capa 1: <em>Backends</em> de compilación</strong></p>
<ul>
<li>Motores de reglas para compilar un proyecto.</li>
<li><strong>Compilación incremental</strong>.</li>
<li><code>make</code> es el estándar tradicional</li>
<li><code>ninja</code> es una versión ultrarrápida, centrada en <strong>CI</strong>.</li>
</ul>
</section>
<section id="capas-y-ecosistema-de-compilación-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="capas-y-ecosistema-de-compilación-3">Capas y ecosistema de compilación</h2>
<p>Existe una <strong>jerarquía</strong> de capas para la compilación y la producción de proyectos <em>software</em>.</p>
<p><strong>Capa 1.5: Optimizadores de compilación</strong></p>
<ul>
<li>Mejoras de rendimiento para la compilación de proyectos.</li>
<li><code>ccache / sccache</code> para realizar un cacheo local de la compilación.</li>
<li><code>distcc / Iceceram</code> para hacer compilación distribuida en red.</li>
</ul>
</section>
<section id="capas-y-ecosistema-de-compilación-4" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="capas-y-ecosistema-de-compilación-4">Capas y ecosistema de compilación</h2>
<p>Existe una <strong>jerarquía</strong> de capas para la compilación y la producción de proyectos <em>software</em>.</p>
<p><strong>Capa 2: <em>Build Systems</em> (Tema 6)</strong></p>
<ul>
<li>Generadores de ficheros para <em>backends</em>.</li>
<li>Multiplataforma
<ul>
<li>Son capaces de generar ficheros para compilar en varios Sistemas Operativos</li>
</ul></li>
<li><code>CMake</code> es el estándar.</li>
</ul>
</section>
</section>
<section id="Make" class="level1" data-stack-name="Make">
<h1 data-stack-name="Make">Make</h1>
<section id="conceptos-fundamentales-de-make" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="conceptos-fundamentales-de-make">Conceptos fundamentales de <code>make</code></h2>
<p><strong>Make</strong> es un <strong><em>backend</em> de compilación</strong></p>
</section>
<section id="conceptos-fundamentales-de-make-1" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="conceptos-fundamentales-de-make-1">Conceptos fundamentales de <code>make</code></h2>
<p><strong>Make</strong> es un <strong><em>backend</em> de compilación</strong></p>
<ul>
<li>Convierte los ficheros fuente en <strong>cualquier objetivo que propongas</strong>.</li>
<li>Sabe qué comandos se deben ejecutar y en <strong>qué orden</strong>.</li>
<li>Usa <em>timestamps</em> garantizar la <strong>compilación incremental</strong>.</li>
</ul>
</section>
<section id="conceptos-fundamentales-de-make-2" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="conceptos-fundamentales-de-make-2">Conceptos fundamentales de <code>make</code></h2>
<p>Se ejecuta a través del comando <code>make</code> en el terminal.</p>
</section>
<section id="conceptos-fundamentales-de-make-3" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="conceptos-fundamentales-de-make-3">Conceptos fundamentales de <code>make</code></h2>
<p>Se ejecuta a través del comando <code>make</code> en el terminal.</p>
<p>En el directorio debe haber un fichero <code>Makefile</code>.</p>
</section>
<section id="makefiles-básicos" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="makefiles-básicos">Makefiles básicos</h2>
<p>Su funcionamiento consiste en establecer una lista de <strong>dependencias</strong>.</p>
</section>
<section id="makefiles-básicos-1" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-1">Makefiles básicos</h2>
<p>Su funcionamiento consiste en establecer una lista de <strong>dependencias</strong>.</p>
<ul>
<li>Hay un <strong>fichero fuente</strong> y un <strong>fichero destino</strong>.
<ul>
<li>Si el <strong>fuente cambia</strong> el destino <strong>también</strong> (<em>timestamps</em>).</li>
</ul></li>
<li>Especificamos una serie de reglas para poder llegar al <strong>destino</strong>.
<ul>
<li>Las reglas siempre van con <strong>tabulador</strong> delante.</li>
</ul></li>
</ul>
</section>
<section id="makefiles-básicos-2" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-2">Makefiles básicos</h2>
<p><strong>Estructura básica de un makefile</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dv">OBJETIVO:</span><span class="dt"> FUENTE</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>REGLA 1</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    REGLA 2</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="makefiles-básicos-3" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-3">Makefiles básicos</h2>
<p><strong>Estructura básica de un makefile</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dv">main.o:</span><span class="dt"> main.cpp</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -c main.cpp -I .</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="makefiles-básicos-4" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-4">Makefiles básicos</h2>
<p><strong>Definición de múltiples objetivos</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dv">main.o:</span><span class="dt"> main.cpp</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -c main.cpp -I .</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dv">auxiliar.o:</span><span class="dt"> auxiliar.cpp</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -c auxiliar.cpp -I .</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="makefiles-básicos-5" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-5">Makefiles básicos</h2>
<p><strong>Definición de múltiples objetivos</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dv">main.o:</span><span class="dt"> main.cpp</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -c main.cpp -I .</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dv">auxiliar.o:</span><span class="dt"> auxiliar.cpp</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -c auxiliar.cpp -I .</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>¿Qué resultado da?</p>
</section>
<section id="makefiles-básicos-6" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-6">Makefiles básicos</h2>
<p><strong>Definición de múltiples objetivos</strong></p>
<p>Un <code>Makefile</code> debe tener <strong>estructura de árbol</strong>.</p>
</section>
<section id="makefiles-básicos-7" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-7">Makefiles básicos</h2>
<p><strong>Definición de múltiples objetivos</strong></p>
<p>Un <code>Makefile</code> debe tener <strong>estructura de árbol</strong>.</p>
<ul>
<li>Una instrucción raíz que tiene varias dependencias.
<ul>
<li>Dichas dependencias son <strong>objetivos</strong>, los cuales tienen otras dependencias.</li>
</ul></li>
</ul>
</section>
<section id="makefiles-básicos-8" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-8">Makefiles básicos</h2>
<p><strong>Definición de múltiples objetivos</strong></p>
<p>Un <code>Makefile</code> debe tener <strong>estructura de árbol</strong>.</p>
<ul>
<li>Una instrucción raíz que tiene varias dependencias.
<ul>
<li>Dichas dependencias son <strong>objetivos</strong>, los cuales tienen otras dependencias.</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Advertencia
</div>
</div>
<div class="callout-body-container callout-body">
<p>Por defecto, el comando <code>make</code> ejecuta el <strong>primer</strong> objetivo del fichero y asume que éste es el <strong>objetivo raíz</strong>.</p>
</div>
</div>
</section>
<section id="makefiles-básicos-9" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-9">Makefiles básicos</h2>
<p><strong>Definición de múltiples objetivos</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dv">ejecutable:</span><span class="dt"> main.o auxiliar.o</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="dv">main.o:</span><span class="dt"> main.cpp</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -c main.cpp -I .</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="dv">auxiliar.o:</span><span class="dt"> auxiliar.cpp</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -c auxiliar.cpp -I .</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="makefiles-básicos-10" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-10">Makefiles básicos</h2>
<p><strong>Definición de múltiples objetivos</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource makefile number-lines code-with-copy"><code class="sourceCode makefile"><span id="cb9-1"><a href="#cb9-1"></a><span class="dv">ejecutable:</span><span class="dt"> main.o auxiliar.o</span></span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="dv">main.o:</span><span class="dt"> main.cpp</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="er">    </span>g++ -c main.cpp -I .</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="dv">auxiliar.o:</span><span class="dt"> auxiliar.cpp</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="er">    </span>g++ -c auxiliar.cpp -I .</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="makefiles-básicos-11" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-11">Makefiles básicos</h2>
<p><strong>Definición de múltiples objetivos</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource makefile number-lines code-with-copy"><code class="sourceCode makefile"><span id="cb10-1"><a href="#cb10-1"></a><span class="dv">ejecutable:</span><span class="dt"> main.o auxiliar.o</span></span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="dv">main.o:</span><span class="dt"> main.cpp</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="er">    </span>g++ -c main.cpp -I .</span>
<span id="cb10-5"><a href="#cb10-5"></a></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="dv">auxiliar.o:</span><span class="dt"> auxiliar.cpp</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="er">    </span>g++ -c auxiliar.cpp -I .</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="makefiles-básicos-12" class="level2" data-auto-animate="true," data-visibility="uncounted">
<h2 data-auto-animate="true," data-visibility="uncounted" class="anchored" data-anchor-id="makefiles-básicos-12">Makefiles básicos</h2>
<p><strong>Definición de múltiples objetivos</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource makefile number-lines code-with-copy"><code class="sourceCode makefile"><span id="cb11-1"><a href="#cb11-1"></a><span class="dv">ejecutable:</span><span class="dt"> main.o auxiliar.o</span></span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="dv">main.o:</span><span class="dt"> main.cpp</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="er">    </span>g++ -c main.cpp -I .</span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="dv">auxiliar.o:</span><span class="dt"> auxiliar.cpp</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="er">    </span>g++ -c auxiliar.cpp -I .</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>¿Qué salida genera este makefile?</p>
</section>
<section id="generalizando-los-makefiles" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="generalizando-los-makefiles">Generalizando los makefiles</h2>
<p>Así, deberíamos añadir los objetivos uno a uno y actualizar el principal.</p>
<p>Aún siendo viable… ¿es lo mejor?</p>
</section>
<section id="generalizando-los-makefiles-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="generalizando-los-makefiles-1">Generalizando los makefiles</h2>
<p>Así, deberíamos añadir los objetivos uno a uno y actualizar el principal.</p>
<p>Aún siendo viable… ¿es lo mejor?</p>
<div class="badge">
<p>Los makefiles aceptan <strong>variables</strong> y <strong>macros</strong> para generalizar y simplificar el proceso de compilación.</p>
</div>
</section>
<section id="generalizando-los-makefiles-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="generalizando-los-makefiles-2">Generalizando los makefiles</h2>
<p><strong>Macros</strong></p>
<p>Símbolos específicos que los makefiles interprentan para obtener información en la regla actual. Algunos conocidos:</p>
<ul>
<li><code>%</code> representa el TODO, como en el terminal el <code>*</code>.</li>
<li><code>$^</code> representa la lista de dependencias completa de ese objetivo.</li>
<li><code>$@</code> representa al objetivo actual.</li>
</ul>
</section>
<section id="generalizando-los-makefiles-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="generalizando-los-makefiles-3">Generalizando los makefiles</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dv">ejecutable:</span><span class="dt"> main.o auxiliar.o</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o :</span><span class="dt"> %.cpp</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> -c <span class="ch">$^</span> -I.</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generalizando-los-makefiles-4" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="generalizando-los-makefiles-4">Generalizando los makefiles</h2>
<p>También se pueden definir variables que usamos en el fichero</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJECTS</span> <span class="ch">:=</span><span class="st"> main.o auxiliar.o</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="dv">ejecutable:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJECTS</span><span class="ch">)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> <span class="ch">$^</span> &lt;def_librerias&gt;</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o :</span><span class="dt"> %.cpp</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> -c <span class="ch">$^</span> -I.</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generalizando-los-makefiles-5" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="generalizando-los-makefiles-5">Generalizando los makefiles</h2>
<p>También existen funciones especiales para facilitar el proceso</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SOURCES</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wildcard</span><span class="st"> *.cpp</span><span class="ch">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJECTS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">subst</span><span class="st"> .cpp</span><span class="kw">,</span><span class="st">.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SOURCES</span><span class="ch">))</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="dv">ejecutable:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJECTS</span><span class="ch">)</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> <span class="ch">$^</span> &lt;def_librerias&gt;</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o :</span><span class="dt"> %.cpp</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> -c <span class="ch">$^</span> -I.</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="múltiples-objetivos" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="múltiples-objetivos">Múltiples objetivos</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SOURCES</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wildcard</span><span class="st"> *.cpp</span><span class="ch">)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJECTS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">subst</span><span class="st"> .cpp</span><span class="kw">,</span><span class="st">.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SOURCES</span><span class="ch">))</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dv">ejecutable:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJECTS</span><span class="ch">)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> <span class="ch">$^</span> &lt;def_librerias&gt;</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o :</span><span class="dt"> %.cpp</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> -c <span class="ch">$^</span> -I.</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="dv">info:</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="kw">info</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SOURCES</span><span class="ch">))</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="kw">info</span><span class="st"> </span><span class="ch">$(</span><span class="dt">OBJECTS</span><span class="ch">))</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="múltiples-objetivos-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="múltiples-objetivos-1">Múltiples objetivos</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SOURCES</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wildcard</span><span class="st"> *.cpp</span><span class="ch">)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJECTS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">subst</span><span class="st"> .cpp</span><span class="kw">,</span><span class="st">.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SOURCES</span><span class="ch">))</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="dv">ejecutable:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJECTS</span><span class="ch">)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> <span class="ch">$^</span> &lt;def_librerias&gt;</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o :</span><span class="dt"> %.cpp</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> -c <span class="ch">$^</span> -I.</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="dv">info:</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="kw">info</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SOURCES</span><span class="ch">))</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="kw">info</span><span class="st"> </span><span class="ch">$(</span><span class="dt">OBJECTS</span><span class="ch">))</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Advertencia
</div>
</div>
<div class="callout-body-container callout-body">
<p>Recuerda que, para que se ejecute <code>info</code>, debes explicitarlo cuando llames a <code>make</code>.</p>
</div>
</div>
</section>
<section id="múltiples-objetivos-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="múltiples-objetivos-2">Múltiples objetivos</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SOURCES</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">wildcard</span><span class="st"> *.cpp</span><span class="ch">)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJECTS</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">subst</span><span class="st"> .cpp</span><span class="kw">,</span><span class="st">.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SOURCES</span><span class="ch">))</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dt">.PHONY</span>  <span class="ch">:=</span><span class="st"> clean</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="dv">ejecutable:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJECTS</span><span class="ch">)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> <span class="ch">$^</span> &lt;def_librerias&gt;</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="dv">%.o :</span><span class="dt"> %.cpp</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -o <span class="ch">$@</span> -c <span class="ch">$^</span> -I.</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="dv">info:</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="kw">info</span><span class="st"> </span><span class="ch">$(</span><span class="dt">SOURCES</span><span class="ch">))</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="ch">$(</span><span class="kw">info</span><span class="st"> </span><span class="ch">$(</span><span class="dt">OBJECTS</span><span class="ch">))</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>rm *.o</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    rm -rf dist/</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>¿Cuál es la diferencia entre <code>info</code> y <code>clean</code>?</p>
</section>
<section id="objetivos-especiales" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="objetivos-especiales">Objetivos especiales</h2>
<p>En un proyecto <em>software</em> se esperan, al menos, los siguientes objetivos:</p>
<div class="incremental">
<ul class="incremental">
<li><code>all</code>: Será el primero y representa el objetivo por defecto.</li>
<li><code>clean</code>: Borra todos los ficheros intermedios que se puedan volver a generar al ejecutar make.</li>
<li><code>dist</code>: Crea un fichero que contiene la distribución del proyecto.</li>
<li><code>install</code>: Instala el resultado de crear el proyecto.</li>
<li><code>uninstall</code>: Desinstala el resultado de crear el proyecto.</li>
</ul>
</div>
</section>
<section id="dependencias-de-orden" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="dependencias-de-orden">Dependencias de orden</h2>
<p>Es posible condicionar el orden de ejecución de las instrucciones de un <code>makefile</code> mediante dependencias de orden.</p>
</section>
<section id="dependencias-de-orden-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="dependencias-de-orden-1">Dependencias de orden</h2>
<p>Es posible condicionar el orden de ejecución de las instrucciones de un <code>makefile</code> mediante dependencias de orden. Se definen a través del símbolo <code>|</code>.</p>
</section>
<section id="dependencias-de-orden-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="dependencias-de-orden-2">Dependencias de orden</h2>
<div class="badge">
<p>Su único propósito es <strong>garantizar que la dependencia existe</strong> antes de ejecutar la regla.</p>
</div>
</section>
<section id="dependencias-de-orden-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="dependencias-de-orden-3">Dependencias de orden</h2>
<div class="badge">
<p>Su único propósito es <strong>garantizar que la dependencia existe</strong> antes de ejecutar la regla.</p>
</div>
<p>¿Para qué crees que son útiles?</p>
</section>
<section id="dependencias-de-orden-4" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="dependencias-de-orden-4">Dependencias de orden</h2>
<pre><code>build/%.o: %.cpp
    g++ $(CFLAGS) -c -Iinclude $&lt; -o $@</code></pre>
</section>
<section id="dependencias-de-orden-5" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="dependencias-de-orden-5">Dependencias de orden</h2>
<pre><code>build/%.o: %.cpp | build
    g++ $(CFLAGS) -c -Iinclude $&lt; -o $@

build:
    mkdir build/</code></pre>
</section>
<section id="makfiles-multinivel" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="makfiles-multinivel">Makfiles multinivel</h2>
<p>Si el proyecto que desarrollamos tiene la entidad suficiente, lo dividiremos en varios módulos, estando el código de cada uno de ellos en un subdirectorio.</p>
</section>
<section id="makfiles-multinivel-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="makfiles-multinivel-1">Makfiles multinivel</h2>
<p>Si el proyecto que desarrollamos tiene la entidad suficiente, lo dividiremos en varios módulos, estando el código de cada uno de ellos en un subdirectorio.</p>
<p>Por ejemplo: <code>src\</code>, <code>vendor\</code>, <code>tests\</code></p>
</section>
<section id="makfiles-multinivel-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="makfiles-multinivel-2">Makfiles multinivel</h2>
<p>Si el proyecto que desarrollamos tiene la entidad suficiente, lo dividiremos en varios módulos, estando el código de cada uno de ellos en un subdirectorio.</p>
<p>Por ejemplo: <code>src\</code>, <code>vendor\</code>, <code>tests\</code></p>
<div class="badge">
<p>¿Cómo gestionamos el proceso de compilación cuando incluimos esta complejidad estructural?</p>
</div>
</section>
<section id="makfiles-multinivel-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="makfiles-multinivel-3">Makfiles multinivel</h2>
<p>Proyecto de ejemplo</p>
<pre><code>proyecto/
├─ src/
│  ├─ main.cpp
│  └─ util.cpp
├─ lib/
│  └─ mathx.cpp
└─ include/
   └─ app.h</code></pre>
</section>
<section id="estrategia-monolítica" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="estrategia-monolítica">Estrategia monolítica</h2>
<p><strong><em>One Makefile Rules All</em></strong></p>
<div class="fragment">
<p>Creamos un único <code>Makefile</code> (ubicado en la raíz) que gestiona absolutamente todas las dependencias</p>
</div>
</section>
<section id="estrategia-monolítica-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-monolítica-1">Estrategia monolítica</h2>
<pre><code>proyecto/
├─ Makefile
├─ src/
│  ├─ main.cpp
│  └─ util.cpp
├─ lib/
│  └─ mathx.cpp
└─ include/
   └─ app.h</code></pre>
</section>
<section id="estrategia-monolítica-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-monolítica-2">Estrategia monolítica</h2>
<p>Primero hay que descubrir los fuentes y generar los <code>.o</code> correspondientes</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">BUILD</span>   <span class="ch">:=</span><span class="st"> build</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">SRC_DIRS</span> <span class="ch">:=</span><span class="st"> src lib</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS</span>     <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> find </span><span class="ch">$(</span><span class="dt">SRC_DIRS</span><span class="ch">)</span><span class="st"> -name '*.cpp'</span><span class="ch">)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span>     <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">patsubst</span><span class="st"> %.cpp</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">BUILD</span><span class="ch">)</span><span class="st">/%.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">))</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="estrategia-monolítica-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-monolítica-3">Estrategia monolítica</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="dv">game:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ <span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span> -o <span class="ch">$@</span> <span class="ch">$(</span><span class="dt">LDFLAGS</span><span class="ch">)</span> </span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="estrategia-monolítica-4" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-monolítica-4">Estrategia monolítica</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dv">game:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ <span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span> -o <span class="ch">$@</span> <span class="ch">$(</span><span class="dt">LDFLAGS</span><span class="ch">)</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dv">$(BUILD)/%.o:</span><span class="dt"> %.cpp | </span><span class="ch">$(</span><span class="dt">BUILD</span><span class="ch">)</span><span class="dt">/%/</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c -Iinclude <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="estrategia-monolítica-5" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-monolítica-5">Estrategia monolítica</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="dv">game:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ <span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span> -o <span class="ch">$@</span> <span class="ch">$(</span><span class="dt">LDFLAGS</span><span class="ch">)</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="dv">$(BUILD)/%.o:</span><span class="dt"> %.cpp | </span><span class="ch">$(</span><span class="dt">BUILD</span><span class="ch">)</span><span class="dt">/%/</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c -Iinclude <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="dv">$(BUILD)/%/:</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">mkdir -p </span><span class="ch">$@</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="estrategia-monolítica-6" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-monolítica-6">Estrategia monolítica</h2>
<p><strong>Ventajas</strong>:</p>
<ul>
<li>Simple: mantienes un solo <code>Makefile</code> por proyecto.</li>
<li>Mejor manejo de dependencias.</li>
<li>Paralelizable: <code>make -j</code> no rompe las dependencias.</li>
</ul>
</section>
<section id="estrategia-recursiva" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="estrategia-recursiva">Estrategia recursiva</h2>
<p><code>make</code> <strong>permite realizar llamadas recursivas</strong>.</p>
</section>
<section id="estrategia-recursiva-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-recursiva-1">Estrategia recursiva</h2>
<p><code>make</code> <strong>permite realizar llamadas recursivas</strong>.</p>
<p>Cada carpeta contiene su propio <code>Makefile</code>.</p>
</section>
<section id="estrategia-recursiva-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-recursiva-2">Estrategia recursiva</h2>
<p><code>make</code> <strong>permite realizar llamadas recursivas</strong>.</p>
<p>Cada carpeta contiene su propio <code>Makefile</code>.</p>
<p>Un <code>Makefile</code> coordinador se encarga de llamar a cada uno de ellos.</p>
</section>
<section id="estrategia-recursiva-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-recursiva-3">Estrategia recursiva</h2>
<pre><code>proyecto/
├─ Makefile
├─ src/
│  ├─ main.cpp
│  ├─ util.cpp
│  └─ Makefile
├─ lib/
│  ├─ Makefile
│  └─ mathx.cpp
└─ include/
   ├─ Makefile
   └─ app.h</code></pre>
</section>
<section id="estrategia-recursiva-4" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-recursiva-4">Estrategia recursiva</h2>
<p>Código del <code>Makefile</code> coordinador</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="dt">SUBDIRS</span> <span class="ch">=</span><span class="st"> lib src</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span><span class="dt"> BUILD </span><span class="ch">=</span><span class="st"> build</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY:</span><span class="dt"> all </span><span class="ch">$(</span><span class="dt">SUBDIRS</span><span class="ch">)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> </span><span class="ch">$/</span><span class="dt">(SUBDIRS)</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">echo </span><span class="st">"Proyecto compilado correctamente"</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="dv">$(SUBDIRS):</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">MAKE</span><span class="ch">)</span> -C <span class="ch">$@</span> all --no-print-directory</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="estrategia-recursiva-5" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-recursiva-5">Estrategia recursiva</h2>
<p>Código del <code>Makefile</code> de <code>src</code> (por ejemplo)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="dt">BIN</span>     <span class="ch">=</span><span class="st"> game</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="dt">SRCS</span>    <span class="ch">=</span><span class="st"> %.cpp</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="dt">OBJS</span>    <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">patsubst</span><span class="st"> %.cpp</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">BUILD</span><span class="ch">)</span><span class="st">/src/%.o</span><span class="kw">,</span><span class="ch">$(</span><span class="dt">SRCS</span><span class="ch">))</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY:</span><span class="dt"> all</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">BIN</span><span class="ch">)</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="dv">$(BIN):</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">LIBSTATIC</span><span class="ch">)</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">OBJS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">LIBSTATIC</span><span class="ch">)</span> -o <span class="ch">$@</span> <span class="ch">$(</span><span class="dt">LDFLAGS</span><span class="ch">)</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="dv">$(BUILD)/src/%.o:</span><span class="dt"> %.c | </span><span class="ch">$(</span><span class="dt">BUILD</span><span class="ch">)</span><span class="dt">/src/</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CFLAGS</span><span class="ch">)</span> -c <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="dv">$(BUILD)/src/:</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">mkdir </span><span class="ch">$@</span></span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="estrategia-monolítica-7" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="estrategia-monolítica-7">Estrategia monolítica</h2>
<p><strong>Ventajas</strong>:</p>
<ul>
<li><code>Makefile</code> más sencillo y mayor limpieza visual.</li>
<li>Coordinación del proyecto a través de un makefile global.</li>
<li>Permite compilaciones parciales para <em>testear</em> módulos.</li>
</ul>
</section>
<section id="la-recursividad-es-buena" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="la-recursividad-es-buena">¿La recursividad es buena?</h2>
<p>Tema polémico en la propia comunidad de C++:</p>
<ul>
<li>Peter Miller: <em>Recursive Make Considered Harmful</em>. Los <code>make</code> recursivos fragmentan el grafo de dependencias y eso lleva a builds incoherentes, largos tiempos de espera o necesidad de hacer make clean con frecuencia.</li>
</ul>
</section>
<section id="la-recursividad-es-buena-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="la-recursividad-es-buena-1">¿La recursividad es buena?</h2>
<p>Tema polémico en la propia comunidad de C++:</p>
<ul>
<li>En <em>StackOverflow</em> también hay debate:</li>
</ul>
<blockquote class="blockquote">
<p>Recursive makefiles are bad primarily because you partition your dependency tree into several trees. This prevents dependencies between make instances from being expressed correctly.</p>
</blockquote>
</section>
<section id="la-recursividad-es-buena-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="la-recursividad-es-buena-2">¿La recursividad es buena?</h2>
<p>Tema polémico en la propia comunidad de C++:</p>
<ul>
<li>En <em>StackOverflow</em> también hay debate:</li>
</ul>
<blockquote class="blockquote">
<p>Recursive make was originally meant … as long as there is a dependency across the recursive structure, make will make it very hard to fix the order.</p>
</blockquote>
</section>
<section id="la-recursividad-es-buena-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="la-recursividad-es-buena-3">¿La recursividad es buena?</h2>
<p>Tema polémico en la propia comunidad de C++:</p>
<div class="badge">
<p>Sistemas de build como CMake, Meson, Bazel, y otros escritos funcionalmente (Shake) han ganado popularidad porque abordan estos problemas: permiten gestionar dependencias completas sin renunciar a modularidad y escalabilidad.</p>
</div>
</section>
<section id="ejecución-paralela" class="level2">
<h2 class="anchored" data-anchor-id="ejecución-paralela">Ejecución paralela</h2>
<div class="incremental">
<ul class="incremental">
<li><p><code>make</code> puede lanzar compilaciones en paralelo.</p></li>
<li><p>Para ello debes emplear la opción <code>-j</code> seguida del numero de trabajos en paralelo a lanzar, por ejemplo: <code>make -j2</code></p></li>
<li><p>Lanzar trabajos en paralelo suele descubrir fallos a la hora de especificar las dependencias, no es lo mismo satisfacerlas de forma secuencial que en paralelo.</p></li>
</ul>
</div>
</section>
</section>
<section id="Ccache" class="level1" data-stack-name="Ccache">
<h1 data-stack-name="Ccache">Caché de compilación</h1>
<section id="un-gran-límite-de-make" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="un-gran-límite-de-make">Un gran límite de <code>make</code></h2>
<p><code>make</code> garantiza que un fichero no se vuelva a recompilar a través de su <em>timestamp</em>.</p>
</section>
<section id="un-gran-límite-de-make-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="un-gran-límite-de-make-1">Un gran límite de <code>make</code></h2>
<p><code>make</code> garantiza que un fichero no se vuelva a recompilar a través de su <em>timestamp</em>.</p>
<p>Pero ¿qué sucede si <strong>cambio un comentario en un fichero</strong>?</p>
</section>
<section id="un-gran-límite-de-make-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="un-gran-límite-de-make-2">Un gran límite de <code>make</code></h2>
<p><code>make</code> garantiza que un fichero no se vuelva a recompilar a través de su <em>timestamp</em>.</p>
<p>Pero ¿qué sucede si <strong>cambio un comentario en un fichero</strong>?</p>
<p><code>make</code> compilará dicho fichero, aunque <strong>el resultado sea el mismo</strong>.</p>
</section>
<section id="cachear-compilaciones" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="cachear-compilaciones">Cachear compilaciones</h2>
<p>La solución es guardar <strong>compilaciones temporales</strong> (caché) de la compilación del proyecto.</p>
</section>
<section id="cachear-compilaciones-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="cachear-compilaciones-1">Cachear compilaciones</h2>
<p>La solución es guardar <strong>compilaciones temporales</strong> (caché) de la compilación del proyecto.</p>
<p>Si el resultado va a ser el mismo, <strong>devolver el resultado ya obtenido</strong>.</p>
</section>
<section id="ccache" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="ccache">Ccache</h2>
<p><em>Compiler Cache</em> (<code>ccache</code>) es una herramienta que nos permite realizar esto.</p>
</section>
<section id="ccache-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="ccache-1">Ccache</h2>
<p><em>Compiler Cache</em> (<code>ccache</code>) es una herramienta que nos permite realizar esto.</p>
<p>Se utiliza como una <strong>herramienta complementaria al compilador</strong>.</p>
<pre class="shell"><code>ccache g++ -o app src.cpp</code></pre>
</section>
<section id="características" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="características">Características</h2>
<ul>
<li>La versión actual de ccache soporta los lenguajes: <code>C</code>, <code>C++</code>, <code>Objective-C</code> y <code>Objective-C++</code>.</li>
<li>Mantiene estadísticas de aciertos/fallos.</li>
<li>Gestión automática del tamaño de la cache.</li>
<li>Puede cachear compilaciones con “warnings”.</li>
<li>Añade una sobrecarga mínima al proceso de compilación.</li>
<li>Opcionalmente comprime los archivos en la cache para ahorrar sitio.</li>
</ul>
</section>
<section id="uso-de-ccache" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="uso-de-ccache">Uso de <code>ccache</code></h2>
<p>Se puede usar como <strong>prefijo</strong>.</p>
<pre class="shell"><code>ccache g++ -o app src.cpp</code></pre>
</section>
<section id="uso-de-ccache-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="uso-de-ccache-1">Uso de <code>ccache</code></h2>
<p>Se puede usar como <strong>prefijo</strong>.</p>
<pre class="shell"><code>ccache g++ -o app src.cpp</code></pre>
<p>O <em>suplantando</em> al compilador</p>
<pre class="shell"><code>cp ccache /usr/local/bin/
ln -s ccache /usr/local/bin/gcc
ln -s ccache /usr/local/bin/g++
ln -s ccache /usr/local/bin/cc
ln -s ccache /usr/local/bin/c++</code></pre>
</section>
<section id="cómo-funciona-ccache" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="cómo-funciona-ccache">Cómo funciona <code>ccache</code></h2>
<p><code>cache</code> calcula un <strong>hash</strong> para identificar <strong>información única</strong> en la compilación</p>
<div class="incremental">
<ul class="incremental">
<li>Contenido del fichero fuente <strong>en compilación</strong>.</li>
<li>Parámetros del compilador.</li>
<li>Versión del compilador.</li>
</ul>
</div>
</section>
<section id="cómo-funciona-ccache-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="cómo-funciona-ccache-1">Cómo funciona <code>ccache</code></h2>
<p><code>cache</code> calcula un <strong><em>hash</em></strong> para identificar <strong>información única</strong> en la compilación</p>
<div class="incremental">
<ul class="incremental">
<li>Contenido del fichero fuente <strong>en compilación</strong>.</li>
<li>Parámetros del compilador.</li>
<li>Versión del compilador.</li>
</ul>
</div>
<p>Utiliza el algoritmo <code>MD4</code> para codificar dicho <em>hash</em>.</p>
</section>
<section id="cómo-funciona-ccache-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="cómo-funciona-ccache-2">Cómo funciona <code>ccache</code></h2>
<p><code>cache</code> calcula un <strong><em>hash</em></strong> para identificar <strong>información única</strong> en la compilación</p>
<p>Si encuentra un <em>hash</em> idéntico en su registro: devuelve el resultado sin compilar.</p>
</section>
<section id="cómo-funciona-ccache-3" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="cómo-funciona-ccache-3">Cómo funciona <code>ccache</code></h2>
<p><code>cache</code> calcula un <strong><em>hash</em></strong> para identificar <strong>información única</strong> en la compilación</p>
<p>Si encuentra un <em>hash</em> idéntico en su registro: devuelve el resultado sin compilar.</p>
<p>Si no encuentra nada: compila y guarda el resultado.</p>
</section>
</section>
<section id="Ninja" class="level1" data-stack-name="Ninja">
<h1 data-stack-name="Ninja">Ninja</h1>
<section id="los-makefiles-están-bien-pero" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="los-makefiles-están-bien-pero">Los makefiles están bien pero…</h2>
<ul>
<li>Los proyectos grandes generan <strong><strong>builds</strong> lentas</strong>.</li>
<li>Ni siquiera con la compilación paralela es suficiente</li>
<li>Necesitamos <strong>una herramienta más rápida</strong>.</li>
</ul>
</section>
<section id="qué-es-ninja" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="qué-es-ninja">¿Qué es Ninja?</h2>
<p>Ninja es un sistemema de construcción y compilación enfocado en la <strong>velocidad</strong>.</p>
</section>
<section id="qué-es-ninja-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="qué-es-ninja-1">¿Qué es Ninja?</h2>
<p>Ninja es un sistemema de construcción y compilación enfocado en la <strong>velocidad</strong>.</p>
<ul>
<li>Minimaliesta: tiene menos funciones y mayor rendimiento.</li>
<li><em>Do less, but do it quick</em>.</li>
<li>No reemplaza a <code>make</code>, pero se usa <strong>cada vez más</strong> con <em>Build Systems</em> como CMake, Meson, etc.</li>
</ul>
</section>
<section id="ninja-básico" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="ninja-básico">Ninja básico</h2>
<p>En <strong>Make</strong> escribes reglas y dependencias en un <code>Makefile</code>. El motor ya decide qué hacer y cómo ejecutarse.</p>
</section>
<section id="ninja-básico-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="ninja-básico-1">Ninja básico</h2>
<p>En <strong>Make</strong> escribes reglas y dependencias en un <code>Makefile</code>. El motor ya decide qué hacer y cómo ejecutarse.</p>
<p>En <strong>Ninja</strong> defines un <strong>grafo de acciones mínimo</strong> en <code>build.ninja</code>, el cual se ejecuta en el motor en paralelo.</p>
</section>
<section id="ninja-básico-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="ninja-básico-2">Ninja básico</h2>
<p>En <strong>Make</strong> escribes reglas y dependencias en un <code>Makefile</code>. El motor ya decide qué hacer y cómo ejecutarse.</p>
<p>En <strong>Ninja</strong> defines un <strong>grafo de acciones mínimo</strong> en <code>build.ninja</code>, el cual se ejecuta en el motor en paralelo.</p>
<div class="badge">
<p>Piensa en Ninja como <em>el backend de compilación</em>: recibe un DAG muy explícito y lo ejecuta a la máxima velocidad.</p>
</div>
</section>
<section id="de-make-a-ninja" class="level2" data-auto-animate="true">
<h2 data-auto-animate="true" class="anchored" data-anchor-id="de-make-a-ninja">De <code>make</code> a <code>ninja</code></h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="dv">app:</span><span class="dt"> main.o</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc main.o -o app</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="dv">main.o:</span><span class="dt"> main.c</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>gcc -c main.c -o main.o</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="de-make-a-ninja-1" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="de-make-a-ninja-1">De <code>make</code> a <code>ninja</code></h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="dv">app:</span><span class="dt"> main.o</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ main.o -o app</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="dv">main.o:</span><span class="dt"> main.c</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>g++ -c main.cpp -o main.o</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode makefile code-with-copy"><code class="sourceCode makefile"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>rule cc</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">command</span> <span class="ch">=</span><span class="st"> g++ -c </span><span class="ch">$i</span><span class="st">n -o </span><span class="ch">$o</span><span class="st">ut</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>rule link</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">command</span> <span class="ch">=</span><span class="st"> g++ </span><span class="ch">$i</span><span class="st">n -o </span><span class="ch">$o</span><span class="st">ut</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="dv">build main.o :</span><span class="dt"> cc main.cpp</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="dv">build app:</span><span class="dt"> link main.o</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>default app</span></code><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="de-make-a-ninja-2" class="level2" data-auto-animate="true" data-visibility="uncounted">
<h2 data-auto-animate="true" data-visibility="uncounted" class="anchored" data-anchor-id="de-make-a-ninja-2">De <code>make</code> a <code>ninja</code></h2>
<div class="incremental">
<ul class="incremental">
<li>Las entradas <code>$in</code> y las salidas <code>$out</code> siempre tienen un ámbito <strong>local</strong> a la regla.</li>
<li>Objetivo: <code>build salida: regla entradas</code>.</li>
<li>Receta: <code>regla command = ...</code></li>
</ul>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>